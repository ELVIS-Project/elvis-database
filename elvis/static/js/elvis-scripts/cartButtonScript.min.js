function cartButtonRefresh(){var t=$("#collection-count");$(".cart-badge, .cart-button").off("click").tooltip().on("click",function(n){return n.preventDefault(),n.stopImmediatePropagation(),$button=$(this),$button.tooltip("hide"),$button.hasClass("disabled")?($button.blur(),!1):($button.addClass("disabled"),type=$button.hasClass("cart-badge")?"badge":"button",action=$button.hasClass("btn-success")?"add":"remove",void $.ajax({type:"post",url:"/download-cart/",data:$button.parents(".recursive-patch-download-form").serialize(),success:function(n){clearTimeout(cart_timeout),$base_modal.modal("hide"),t.fadeOut(100,function(){t.text("("+n.count+")")}),t.fadeIn(100),init_cart_buttons()},error:function(t){$base_modal_header.html("<h4 class='modal-title'>Error modifying downloads!</h4>"),$base_modal_body.html("<p>Something went wrong and your cart was not modified!</p>"),$base_modal_footer.html("<button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>"),$base_modal.modal("show")}}))})}function init_cart_buttons(){null===$forms&&($forms=$(".recursive-patch-download-form")),null===items&&(items=build_item_dict($forms)),$.ajax({url:"/download-cart/",data:{check_in_cart:JSON.stringify(light_items)},success:function(t){if(null!==t)for(var n=Object.keys(t),a=0;a<n.length;a++){var o=n[a],e=t[o].in_cart;t[o].in_cart!==items[o].in_cart&&(items[o].in_cart=e,light_items[o].in_cart=e,"button"==items[o].button_type?draw_button(t[o],items[o].$elem):draw_badge(t[o],items[o].$elem))}cartButtonRefresh()}})}function build_item_dict(t){items={};for(var n=0;n<t.size();n++){var a=t[n].children;items[a[2].value]={button_type:a[0].value,type:a[1].value,$elem:$(t[n]),in_cart:"init"},light_items[a[2].value]={type:a[1].value,in_cart:"init"}}return items}function draw_button(t,n){var a=$(n);a.children(":button").remove(),t.in_cart===!0?(a.children("[name=action]").val("remove"),a.prepend('<button type="button" class="btn btn-danger cart-button">Remove from Downloads </button>')):t.in_cart===!1&&(a.children("[name=action]").val("add"),a.prepend('<button type="button" class="btn btn-success cart-button">Add to Downloads </button>'))}function draw_badge(t,n){var a=$(n);a.children(":button").remove();var o="",e="";"Piece"===t.in_cart?(o='<button type="button" class="btn btn-mini btn-info disabled cart-badge" data-container="body" data-toggle="tooltip" data-placement="top" title="In cart under piece."><span class="glyphicon glyphicon-lock"> </span> </button>',e="add"):t.in_cart===!0?(o='<button type="button" class="btn btn-mini btn-danger cart-badge" data-container="body" data-toggle="tooltip" data-placement="top" title="Remove from Downloads"><span class="glyphicon glyphicon-minus"> </span> </button>',e="remove"):t.in_cart===!1&&(o='<button type="button" class="btn btn-mini btn-success cart-badge" data-container="body" data-toggle="tooltip" data-placement="top" title="Add to Downloads"><span class="glyphicon glyphicon-plus"> </span> </button> ',e="add"),a.prepend(o),a.children("[name=action]").val(e)}var type=null,action=null,$button=null,cart_timeout=null,items=null,light_items={},$forms=null;