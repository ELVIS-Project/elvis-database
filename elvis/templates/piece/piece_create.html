{% extends "base.html" %}

{% block wrap %}

<!-- The javascript function for the typeahead functionality on the fields. -->

{% block extra_hd %}
        <script type='text/javascript' src="{{ STATIC_URL }}js/elvis-scripts/upload-autocomplete.js"></script>
        <script type='text/javascript' src="{{ STATIC_URL }}js/bs-filestyle.js"></script>
{% endblock %}

<script>
$(document).ready(function($)
{
    autocomplete("id_title", "title-suggestion-menu", "pieceSuggest");
    autocomplete("id_composer", "composer-suggestion-menu", "composerSuggest");
    autocomplete("id_collection", "collection-suggestion-menu", "collectionSuggest");
    $("#id_att_files").filestyle({input:false, iconName: "glyphicon-file", buttonText: "Upload Files"});
    $("#id_comp_pic").filestyle({input:false, iconName: "glyphicon-picture", buttonText: "Composer Picture", disabled: "true"});

    var $newComposerMenu = $("#composer-create-new-menu");
    var $composerInput = $("#id_composer");
    $newComposerMenu.hide();

    $composerInput.on("focusout", function(event)
    {
        var query = $("#id_composer").val();

        if (query.length > 0)
        {
             $.ajax({
                url: "/composers/",
                data: {q: query},
                success: function (data)
                {
                    if (data['count'] == 0)
                    {
                        $newComposerMenu.children().remove(".top-message");
                        $newComposerMenu.prepend("<div class='top-message'><hr><h5>We don't have <strong>" + query + "</strong> in our database. " +
                            "Submitting a piece by an unknown composer will add the composer to the database. <br>" +
                            "Do you have additional information to add to this new composer?</h5><br></div>");
                        $newComposerMenu.slideDown("slow");
                    }
                }
            });
        }
    });

    $composerInput.on("keydown", function(event)
    {
        $newComposerMenu.slideUp("slow");
    });

    $("#hide-composer-create").on("click", function(event){
        $newComposerMenu.slideUp("slow");
    })

});
</script>
<div class="page-header">
    <h2>Upload a Piece</h2>
</div>

<div class="bs-example">
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#required">Basics</a></li>
        <li><a data-toggle="tab" href="#advanced-info">Advanced</a></li>
    </ul>
    <form action="/pieces/" method="post" enctype="multipart/form-data">
    {% csrf_token %}

        <div class="tab-content">

            <div id="required" class="tab-pane fade in active">
                <h4>Piece Information</h4>
                <hr>

                <div class="input-group">
                  <span class="input-group-addon" id="basic-addon1">Title</span>
                  <input type="text" id="id_title" name="title" autocomplete="off" class="form-control" placeholder="e.g. Ach Gott, vom Himmel sieh darein, BWV 2" aria-describedby="basic-addon1">
                </div>
                <div id="title-suggestion-menu"></div>

                <br>

                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">Composer</span>
                    <input type="text" id="id_composer" autocomplete="off" name="composer" class="form-control" placeholder="e.g. Bach, Johann Sebastian" aria-describedby="basic-addon1">
                </div>
                <div id="composer-suggestion-menu"></div>

                <div id="composer-create-new-menu" style="padding-left:50px; padding-right:50px">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <div class="input-group">
                                    <input type='date' name="composer_birth_date" class="form-control unstyled"/>
                                    <span class="input-group-addon">Birth</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <div class="input-group">
                                    <input type='date' name="composer_death_date" class="form-control unstyled"/>
                                    <span class="input-group-addon">Death</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <div class="input-group">
                                    <input name="comp_pic" id="id_comp_pic" type="file" multiple="multiple"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                </div>

                <br>

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon">Composition Start Date</span>
                                <input type='date' name="composition_start_date" class="form-control unstyled"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon">Composition End Date</span>
                                <input type='date' name="composition_end_date" class="form-control unstyled"/>
                            </div>
                        </div>
                    </div>
                </div>

                <hr>
                <span class="help-block">Attach the files for this piece. Acceptable file types are .zip, .pdf, and .mtxt</span>
                <input name="att_files" id="id_att_files" type="file" multiple="multiple"/>
                <br>

                <h4>Movements</h4>
                <hr>
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">Collection</span>
                    <input type="text" id="id_collection" name="collection" autocomplete="off" class="form-control" placeholder="e.g. Bach, Johann Sebastian" aria-describedby="basic-addon1">
                </div>
                <div id="collection-suggestion-menu"></div>

            </div>

            <div id="advanced-info" class="tab-pane fade">
                <h3>Advanced</h3>
                <p>Maybe put tags and stuff here.</p>
            </div>
        </div>
        <br>

        <button type="submit" id="piece-submit" name="piece-submit" class="btn btn-success btn-sm pull-right move">Submit <span class="glyphicon glyphicon-chevron-right"></span></button>
    </form>
</div>





<!--
<input type="text" id="composer_search" class="form-control" placeholder="Composer" aria-describedby="basic-addon1">
-->

<!--
<form action="/pieces/" method="post">
    <input type="hidden" name="csrfmiddlewaretoken" value="fxEDKF7Zr49WliezO22MYHdH85iYnvDA">
    <li><label for="id_title">Title:</label> <input id="id_title" name="title" type="text"></li>
    <li><div id="composer-list">
    <label for="id_composer">Composer:</label> <input class="typeahead" id="id_composer" name="composer" type="text">
    </div></li>
    <li><label for="id_collection">Collection:</label> <input id="id_collection" name="collection" type="text"></li>
    <li><label for="id_comp_start">Comp start:</label> <input id="id_comp_start" name="comp_start" type="text"></li>
    <li><label for="id_comp_end">Comp end:</label> <input id="id_comp_end" name="comp_end" type="text"></li>
    <li><label for="id_number_of_voices">Number of voices:</label> <input id="id_number_of_voices" name="number_of_voices" type="number"></li>
    <li><label for="id_genre">Genre:</label> <input id="id_genre" name="genre" type="text"></li>
    <li><label for="id_voices">Voices:</label> <input id="id_voices" name="voices" type="text"></li>
    <li><label for="id_composer_country">Composer country:</label> <input id="id_composer_country" name="composer_country" type="text"></li>
    <li><label for="id_language">Language:</label> <input id="id_language" name="language" type="text"></li>
    <li><label for="id_source">Source:</label> <input id="id_source" name="source" type="text"></li>
    <li><label for="id_tags">Tags:</label> <input id="id_tags" name="tags" type="text"></li>
    <li><label for="id_comment">Comment:</label> <input id="id_comment" name="comment" type="text"></li>
    <li><label for="id_attachment">Attachment:</label> <input id="id_attachment" name="attachment" type="file"></li>
    <li><label for="id_movements">Movements:</label> <input id="id_movements" name="movements" type="text"></li>
    <input type="submit" value="Submit" />
    </form>
</form>
-->
{%  endblock %}

