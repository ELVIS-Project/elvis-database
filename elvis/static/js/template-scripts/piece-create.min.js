$(document).ready(function(e){autocomplete("title","title_suggestion_menu","pieceSuggest"),autocomplete("composer","composer_suggestion_menu","composerSuggest"),autocomplete("collections","collection_suggestion_menu","collectionSuggest","list"),autocomplete("languages","language_suggestion_menu","languageSuggest","list"),autocomplete("genres","genre_suggestion_menu","genreSuggest","list"),autocomplete("locations","location_suggestion_menu","locationSuggest","list"),autocomplete("sources","source_suggestion_menu","sourceSuggest","list"),autocomplete("instruments_voices","instrumentation_suggestion_menu","instrumentSuggest","list"),autocomplete("tags","tags_suggestion_menu","tagSuggest","list");var o=e("#movement_table");o.dynamicTable({button:e("#new_mov"),table_name:"mov",movement:!0}).dynamicTable("addRow");var t=e("#piece_file_table");t.dynamicTable({button:e("#new_piece_file"),table_name:"files"}).dynamicTable("addRow"),e('[data-toggle="popover"]').popover();var a=e("#composer-create-new-menu"),s=e("#composer");a.hide(),s.on("focusout",function(){var o=e("#composer").val();o.length>0&&e.ajax({url:"/composers/",data:{q:o},success:function(e){0==e.count&&(a.children().remove(".top-message"),a.prepend("<div class='top-message'><span class='help-block'><hr>We don't have <strong>"+o+"</strong> in our database. Submitting a piece by an unknown composer will add the composer to the database. <br>Do you have additional information to add to this new composer?<br><br></span></div>"),a.slideDown("slow"))}})}),s.on("keydown",function(e){13!==e.keyCode&&a.slideUp("slow")}),e(":input").on("input",function(){e(window).on("beforeunload",function(o){return"goto-piece"!==o.target.activeElement.id?"Leaving this page will clear your form.":void e(window).off("beforeunload")}),e(":input").off("input")}),e("input:not(#comment)").on("keydown",function(e){13===e.keyCode&&e.preventDefault()}),e("#new-piece-form").submit(function(o){o.preventDefault(),$base_modal_header.html("<h4 class='modal-title'>Creating Piece...</h4>"),$base_modal_body.html("<div class='progress'><div class='progress-bar progress-bar-striped active' role='progressbar' style='width: 100%'></div> </div>"),$base_modal.modal("show"),e.ajax({type:"post",url:"/pieces/",data:new FormData(this),processData:!1,contentType:!1,success:function(o){if(void 0===o.errors)$base_modal_header.html("<h4 class='modal-title'>Done!</h4>"),$base_modal_body.html("<p>Piece succesfuly uploaded!</p>"),$base_modal_footer.html(".modal-footer").html(" <button type='button' class='btn btn-default' data-dismiss='modal'>Close</button><a href='"+o.url+"' class='btn btn-default' id='goto-piece'>Go to Piece</a>");else{var t="";for(var a in o.errors)"religiosity"===a&&e("input[name='religiosity']").parent().removeClass("btn-default").addClass("btn-danger"),"vocalization"===a?e("input[name='vocalization']").parent().removeClass("btn-default").addClass("btn-danger"):e("#"+a).parent().addClass("has-error"),e("#"+a+"_error").html("<b style='color:red'>"+o.errors[a][0]+"</b>"),t=t+"<strong>"+(a.charAt(0).toUpperCase()+a.slice(1)).replace(/_/g," ")+"</strong>: "+o.errors[a][0]+"<br>";$base_modal_header.html("<h4 class='modal-title'>Form Error<h4>"),$base_modal_body.html("<p>Your submission has the following errors: <br>"+t+"</p>"),$base_modal_footer.html("<button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>")}e("#close_modal").click(function(){$upload_modal.modal("hide")})},error:function(){$base_modal_header.html("<h4 class='modal-title'>Server Error<h4>"),$base_modal_body.html("<p>An error occurred while uploading your file. Please try again, or, if the error persists, <a href='mailto:elvisdatabase@gmail.com?Subject=Upload%20Error'>contact us</a></p>"),$base_modal_footer.html("<button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>")}})});var n=e(".upload-input-field");n.focus(function(o){e(o.target.parentElement.children[0]).popover("toggle")}),n.focusout(function(o){e(o.target.parentElement.children[0]).popover("hide")}),e("input[type=number]").keypress(function(e){return 0!==e.which&&8!==e.which&&(this.value.length>3||e.which<48||e.which>57)?!1:void 0})});