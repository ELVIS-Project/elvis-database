{% extends "base.html" %}
{% load filter_methods %}

{% block wrap %}

<style>

#main-result-frame {
    -moz-box-shadow: 0 0 5px #888;
    -webkit-box-shadow: 0 0 5px#888;
    box-shadow: 0 0 5px #888;
    margin-left:50px;
    margin-right:50px;
    margin-top:20px;
    background-color: #FFFFFF;
    padding-top:15px;
}

.search-input {
    width:90%;
    border-radius:10px;
    height:35px !important;
    font-size:15pt !important;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.25);
    -moz-box-shadow: inset 0 1px 2px rgba(0,0,0,0.25);
    -webkit-box-shadow: inset 0 1px 2px rgba(0,0,0,0.25);
}

.search-icon {
    width:40px;
    height:40px;
    margin-bottom:13px;
}

.submit-button {
    width:10%;
    height:40px !important;
    border-radius:5px;
}

#date-slider {
    margin-left:-18px;
}
#slider-range {
    margin-top:7px;
    width:100%;
}

#date_range {
    width:80px;
    border: 0 !important; 
    color: #f6931f; 
    font-weight: bold;
}

input:focus {
    /*background:#E0FFFF;*/
    font-weight:bold;
}

.table-bordered td {
    font-weight:bold;
}

.table-bordered a {
    /*text-decoration:none;*/
    font-weight:bold;
    color:#333;
}

.table-bordered ul, li {
    font-size:.9em;
    list-style-type: none;
    list-style-position:inside;
    margin:0;
    padding:0;
}

.icon-chevron-down {
    float:right;
}
.onoffswitch {
    position: relative; width: 67px;
    -webkit-user-select:none; -moz-user-select:none; -ms-user-select: none;
    padding-left:3px;
}
.onoffswitch-checkbox {
    display: none;
}
.onoffswitch-label {
    display: block; overflow: hidden; cursor: pointer;
    border: 2px solid #999999; border-radius: 12px;
}
.onoffswitch-inner {
    width: 200%; margin-left: -100%;
    -moz-transition: margin 0.3s ease-in 0s; -webkit-transition: margin 0.3s ease-in 0s;
    -o-transition: margin 0.3s ease-in 0s; transition: margin 0.3s ease-in 0s;
}
.onoffswitch-inner:before, .onoffswitch-inner:after {
    float: left; width: 50%; height: 22px; padding: 0; line-height: 22px;
    font-size: 12px; color: white; font-family: Trebuchet, Arial, sans-serif; font-weight: bold;
    -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box;
}
.onoffswitch-inner:before {
    content: "AND";
    padding-left: 10px;
    background-color: #FF9A2F; color: #FFFFFF;
}
.onoffswitch-inner:after {
    content: "OR";
    padding-right: 10px;
    background-color: #EEEEEE; color: #41E3F2;
    text-align: right;
}
.onoffswitch-switch {
    width: 10px; margin: 6px;
    background: #FFFFFF;
    border: 2px solid #999999; border-radius: 12px;
    position: absolute; top: 0; bottom: 0; right: 41px;
    -moz-transition: all 0.3s ease-in 0s; -webkit-transition: all 0.3s ease-in 0s;
    -o-transition: all 0.3s ease-in 0s; transition: all 0.3s ease-in 0s; 
}
.onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-inner {
    margin-left: 0;
}
.onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-switch {
    right: 0px; 
}
</style>

<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

<script>
  $(function() {
    $( "#slider-range" ).slider({
      range: true,
      min: 1291,
      max: 2013,
      values: [1440, 1600],
      slide: function( event, ui ) {
        $("#date_range").val(ui.values[0] + " - " + ui.values[1]);
      }
    });
    $( "#date_range" ).val( $( "#slider-range" ).slider( "values", 0 ) +
      " - " + $( "#slider-range" ).slider( "values", 1 ) );
  });
  </script>

<script type="text/javascript">

function color(colorname, td_id) {
    var backgroundColor = document.getElementById(td_id).style.background;
    if(backgroundColor.length == 0  || backgroundColor == "rgb(255, 255, 255)") {
        document.getElementById(td_id).style.background = colorname;
    }
    else {
        document.getElementById(td_id).style.background = "#FFFFFF";
    }
}

function scrollList(objectname) {
    var scrollStyle = document.getElementById(objectname).style.display;
    if (scrollStyle == "block" ) {
        document.getElementById("td-"+objectname).style.display = "none";    
        document.getElementById(objectname).style.display = "none";
    }
    else {
        document.getElementById("td-"+objectname).style.display = "block";
        document.getElementById(objectname).style.display = "block";
    }
}

function submitInputs() {
    // First find all clicked filters and add to filter input
    var composer = document.getElementById("td-composer").style.background;
    var corpus = document.getElementById("td-corpus").style.background;
    var tag = document.getElementById("td-tag").style.background;
    var voice = document.getElementById("td-voice").style.background;
    var uploader = document.getElementById("td-uploader").style.background;
    var filterstring = "";
    var filterlist = [composer, corpus, tag, voice, uploader]
    var namelist = ["Composer", "Corpus", "Tag", "voice", "Uploader"]
    for(i=0; i<filterlist.length; i++) {
        if( !(filterlist[i].length == 0 || filterlist[i] == "rgb(255, 255, 255)") ) {
            filterstring += namelist[i] + ",";
        }
    }
    document.getElementById("filter-input").value = filterstring;
    // Now find all the selections within each filter
    var composers = $('li[id^="composer-"]');
    var corpora = $('li[id^="corpus-"]');
    var tags = $('li[id^="tag-"]');
    var voices = $('li[id^="voice-"]');
    var uploaders = $('li[id^="uploader-"]');
    var selections = [composers, corpora, tags, voices, uploaders];
    var selectionNames = ["composers-input", "corpora-input", "tags-input", "voices-input", "uploaders-input"];
    var selectionStrings = ["", "", "", "", "", ""];
    for(i=0; i<selections.length; i++) {
        for(j=0; j<selections[i].length; j++) {
            var color = document.getElementById(selections[i][j].id).style.background;
            if( !(color.length == 0 || color == "rgb(255, 255, 255)") ) {
                var strArr = selections[i][j].id.split('-');
                selectionStrings[i] += strArr[1] + ",";
            }
        }
        document.getElementById(selectionNames[i]).value = selectionStrings[i];
    }
    // Now submit the form 
    document.getElementById("search-form").submit();
}

</script>

    <form action="" method="POST" id="search-form"> {% csrf_token %}

        <div class="container-fluid" id="main-result-frame"> 
            <div class="row-fluid">

                <!-- The main search frame --> 
                <div class="span9" id="search-column">
                    <!-- Search textbox --> 
                    <input type="text" value="Search" name="searchinput" class="search-input"/> <a href="javascript:submitInputs()" ><img class="search-icon" src="{{STATIC_URL}}img/search.png"/></a>
                    <!--<input type="button" value="Go" class="submit-button" onclick="submitInputs()" /> -->

                    <!-- The date slider --> 
                    <div class="container-fluid" id="date-slider">
                        <div class="row-fluid">
                            <div class="span2">
                                <input type="text" name="date_range" id="date_range"/>
                            </div>
                            <div class="span10">
                                <div id="slider-range"></div>
                            </div>
                        </div>
                    </div>

                    {% if query_type %}
                        {% include "search/results/OR.html" %}
                    {% else %}
                        {# Sample queries or explanation for how to use search page? #}
                    {% endif %}

                </div>

                <!-- Hidden inputs for filters and selection within filters -->
                <input type="hidden" id="filter-input" name="filters"/>
                <input type="hidden" id="composers-input" name="composers"/>
                <input type="hidden" id="tags-input" name="tags"/>
                <input type="hidden" id="corpora-input" name="corpora"/>
                <input type="hidden" id="voices-input" name="voices"/>
                <input type="hidden" id="uploaders-input" name="uploaders"/>

                <!-- Filter options --> 
                <div class="span3" id="filter-column">

                    <div class="container-fluid" style="margin-left:-15px;">
                        <div class="row-fluid">
                            <div class="span8" style="margin-top:4px;">
                                <b style="font-size:1.7em;">FILTERS</b>
                            </div>
                            <div class="span4">
                                <div class="onoffswitch">
                                    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" checked>
                                    <label class="onoffswitch-label" for="myonoffswitch">
                                        <div class="onoffswitch-inner"></div>
                                        <div class="onoffswitch-switch"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <table class="table table-bordered">
                        <!-- Filter by composer --> 
                        <tr>
                            <td id="td-composer"> 
                                <a href="javascript:color('#7FFFD4', 'td-composer')"> Composer </a> 
                                <a href="javascript:scrollList('list-composer')"><i class="icon-chevron-down"></i></a>
                            </td>
                        </tr>
                        <tr>
                            <td id="td-list-composer" style="display:none">
                                <div id="list-composer" style="display:none;">
                                        <ul>
                                        {% for composer in composers %}
                                            <a href="javascript:color('#7FFFD4', 'composer-{{composer.id}}')">
                                                <li id="composer-{{composer.id}}"> {{composer.name}} </li>
                                            </a>
                                        {% endfor %}
                                        </ul>
                                </div>
                            </td>
                        </tr>
                        <!-- Filter by tag --> 
                        <tr>
                            <td id="td-tag"> 
                                <a href="javascript:color('#AFEEEE', 'td-tag')"> Tag </a>
                                <a href="javascript:scrollList('list-tag')"><i class="icon-chevron-down"></i></a>
                            </td>
                        </tr>
                        <tr>
                            <td id="td-list-tag" style="display:none">
                                <div id="list-tag" style="display:none;">
                                        <ul>
                                        {% for tag in tags %}
                                            <a href="javascript:color('#AFEEEE', 'tag-{{tag.id}}')">
                                                <li id="tag-{{tag.id}}"> {{tag.name}} </li>
                                            </a>
                                        {% endfor %}
                                        </ul>
                                </div>
                            </td>
                        </tr>
                         <!-- Filter by number of voices --> 
                        <tr>
                            <td id="td-voice"> 
                                <a href="javascript:color('#B0C4DE', 'td-voice')"> Voices </a> 
                                <a href="javascript:scrollList('list-voice')"><i class="icon-chevron-down"></i></a>
                            </td>
                        </tr>
                        <tr>
                            <td id="td-list-voice" style="display:none">
                                <div id="list-voice" style="display:none;">
                                        <ul>
                                        {% for voice in voices %}
                                            <a href="javascript:color('#B0C4DE', 'voice-{{voice.number_of_voices}}')">
                                                <li id="voice-{{voice.number_of_voices}}"> {{voice.number_of_voices|numToWord}} </li>
                                            </a>
                                        {% endfor %}
                                        </ul>
                                </div>
                            </td>
                        </tr>
                         <!-- Filter by corpus --> 
                        <tr>
                            <td id="td-corpus"> 
                                <a href="javascript:color('#87CEFA', 'td-corpus')"> Corpus </a>
                                <a href="javascript:scrollList('list-corpus')"><i class="icon-chevron-down"></i></a>
                            </td>
                        </tr>
                        <tr>
                            <td id="td-list-corpus" style="display:none">
                                <div id="list-corpus" style="display:none;">
                                        <ul>
                                        {% for corpus in corpora %}
                                           <a href="javascript:color('#87CEFA', 'corpus-{{corpus.id}}')">
                                                <li id="corpus-{{corpus.id}}"> {{corpus.title}} </li>
                                            </a>
                                        {% endfor %}
                                        </ul>
                                </div>
                            </td>
                        </tr>
                         <!-- Filter by author --> 
                        <tr>
                            <td id="td-uploader"> 
                                <a href="javascript:color('#B0E0E6', 'td-uploader')"> Author </a>
                                <a href="javascript:scrollList('list-uploader')"><i class="icon-chevron-down"></i></a>
                            </td>
                        </tr>
                        <tr>
                            <td id="td-list-uploader" style="display:none">
                                <div id="list-uploader" style="display:none;">
                                        <ul>
                                        {% for uploader in uploaders %}
                                            <a href="javascript:color('#B0E0E6', 'uploader-{{uploader.id}}')">
                                                <li id="uploader-{{uploader.id}}"> {{uploader.username}} </li>
                                            </a>
                                        {% endfor %}
                                        </ul>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

    </form>

{% endblock %}
