function cartButtonRefresh(){$base_modal=$("#base-modal"),$base_modal_header=$("#base-modal-header"),$base_modal_body=$("#base-modal-body"),$base_modal_footer=$("#base-modal-footer"),$collection_count=$("#collection-count"),$(".cart-badge, .cart-button").off("click").tooltip().on("click",function(o){return o.preventDefault(),o.stopImmediatePropagation(),$button=$(this),$button.hasClass("disabled")?($button.blur(),!1):(type=$button.hasClass("cart-badge")?"badge":"button",action=$button.hasClass("btn-success")?"add":"remove",cart_timeout="add"===action?setTimeout(function(){$base_modal_header.html("<h4 class='modal-title'>Adding to Downloads...</h4>"),$base_modal_body.html("<p>Adding large collections or composer oeuvres to your downloads can take a little time...</p>"),$base_modal_footer.html("<div class='progress'><div class='progress-bar progress-bar-striped active' role='progressbar' style='width: 100%'></div> </div>"),$base_modal.modal("show")},1e3):setTimeout(function(){$base_modal_header.html("<h4 class='modal-title'>Removing from Downloads...</h4>"),$base_modal_body.html("<p>Removing large collections or composer oeuvres from your downloads can take a little time...</p>"),$base_modal_footer.html("<div class='progress'><div class='progress-bar progress-bar-striped active' role='progressbar' style='width: 100%'></div> </div>"),$base_modal.modal("show")},1e3),void $.ajax({type:"post",url:"/downloads/",data:$(o.target).parents(".recursive-patch-download-form").serialize(),success:function(o){clearTimeout(cart_timeout),$base_modal.modal("hide"),$collection_count.fadeOut(100,function(){$collection_count.text("("+o.count+")")}),$collection_count.fadeIn(100),"add"===action?$button.fadeOut(100,function(){$button.blur().tooltip("hide").attr({"data-original-title":"Remove From Downloads"}).tooltip("fixTitle").removeClass("btn-success").addClass("btn-danger"),$($button.siblings("[name='action']")).val("remove"),"badge"===type?$button.html("<span class='glyphicon glyphicon-minus'></span>"):($button.html("Remove from Downloads"),location.reload())}).fadeIn(100):$button.fadeOut(100,function(){$button.blur().tooltip("hide").attr({"data-original-title":"Add to Downloads"}).tooltip("fixTitle").removeClass("btn-danger").addClass("btn-success"),$($button.siblings("[name='action']")).val("add"),"badge"===type?$button.html("<span class='glyphicon glyphicon-plus'></span>"):($button.html("Add to Downloads"),location.reload())}).fadeIn(100)},error:function(o){$base_modal_header.html("<h4 class='modal-title'>Error modifying downloads!</h4>"),$base_modal_body.html("<p>Something went wrong and your cart was not modified!</p>"),$base_modal_footer.html("<button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>")}}))})}var type=null,action=null,$button=null,cart_timeout=null,$base_modal=$("#base-modal"),$base_modal_header=$("#base-modal-header"),$base_modal_body=$("#base-modal-body"),$base_modal_footer=$("#base-modal-footer"),$collection_count=$("#collection-count");