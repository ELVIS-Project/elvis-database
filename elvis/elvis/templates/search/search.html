{% extends "base.html" %}


{% block wrap %}

<head>
    <script type="text/javascript" src="{{STATIC_URL}}js/bootstrap-multiselect.min.js"></script>
    <link rel="stylesheet" href="{{STATIC_URL}}css/bootstrap-multiselect.css" type="text/css"/>
    <script type="text/javascript">

    $(function()
    {
        $('.input-group-addon').tooltip();
            
    });

    $(function() 
    {   
        $('#typefilt').multiselect(
        {
            buttonWidth: '100%',
            numberDisplayed: 6,
            checkboxName: 'typefilt',
            nonSelectedText: 'Any Type',
            nSelectedText: 'Selected Types',
            templates: 
            {
                button: '<button type="button" class="btn btn-lg multiselect-button" data-toggle="dropdown"></button>',
            },
            buttonText: function(options, select) 
            {
                if (options.length == 0 || options.length == 6) 
                {
                  return this.nonSelectedText + ' <b class="caret"></b>';
                }
                else 
                {
                    if (options.length > this.numberDisplayed) 
                    {
                        return options.length + ' ' + this.nSelectedText + ' <b class="caret"></b>';
                    }
                    else 
                    {
                        var selected = '';
                        options.each(function() 
                        {
                            var label = ($(this).attr('label') !== undefined) ? $(this).attr('label') : $(this).html();
             
                            selected += label + ', ';
                        });
                        return selected.substr(0, selected.length - 2) + ' <b class="caret"></b>';
                    }
                }
            },
        });
        $('#sortby').multiselect(
        {
            buttonWidth: '100%',
            checkboxName: 'sortby',
            templates: 
            {
                button: '<button type="button" class="btn btn-lg multiselect-button" data-toggle="dropdown"></button>',
            },
        });
    });

    $(function()
    {
        $('#asearch-submit').click(function()
        {
            $(':input').each(function(){
                if($(this).val() === "" && $(this).attr('name') !== "q")
                {
                    $(this).attr('disabled', true);
                }    
            });
            setTimeout(function(){$('#advanced-search-form').submit()}, 300);
        });
    })

    $(function()
    {
        $('#gsearch-submit').click(function()
        {
            $(':input').each(function()
            {
                if($(this).val() === "" && $(this).attr('name') !== "q")
                {
                    $(this).attr('disabled', true);
                }    
            });
            setTimeout(function(){$('#general-search-form').submit()}, 300);
        });
    })

    $(function()
    {
        var qstr = window.location.search.replace("?", "");
        var qstr_params = $.parseParams(qstr);
        for (var key in qstr_params)
        {
            if(key === 'typefilt' || key === 'type')
            {
                $('#typefilt').multiselect('select', qstr_params[key]);
            }
            else if (key === 'sortby' && qstr_params[key] !== "")
            {
                $('#sortby').multiselect('deselect', "");
                $('#sortby').multiselect('select', qstr_params[key]);
            }
            else
            {
                $('[name='+key+']').val(qstr_params[key]);
            }
        }
    })
    </script>
</head>

<body>
<div class="page-header">
    <h2>Search the Database</h2>
</div>

<div class="row">
    <!-- Tabs bar -->

    <ul class="nav nav-tabs nav-justified">

        <li class="active"><a href="#gsearch" data-toggle="tab"><h4>General Search</h4></a></li>

        <li class=""><a href="#asearch" data-toggle="tab"><h4>Advanced Search</h4></a></li>

        <li class=""><a href="#help" data-toggle="tab"><h4>Information & Help</h4></a></li>

    </ul>

    <!-- Content -->

    <div class="tab-content">

        <!-- General Search -->
        <div class="tab-pane fade in active" id="gsearch">
        
            <!-- Accordion -->
            <div class="panel-body gsearch">
                <form id="general-search-form" action="/search" method="get">
                    <!-- Query Entry -->
                    <div class="row">

                        <div class="input-group input-group-lg col-md-8 col-md-offset-2">
                                <input type="text" class="form-control gsearch" name="q"  >
                                <span class="input-group-btn">
                                    <button class="btn btn-default submit" type="button" id="gsearch-submit"> Search <span class="glyphicon glyphicon-search"></span> </button>
                                </span>
                        </div>
               
                    </div>
                </form>
            </div>

        </div>

        <!-- Advanced Search -->
        <div class="tab-pane fade" id="asearch">
        
            <!-- Accordion -->
            <div class="panel-body">

            <form id="advanced-search-form" action="/search" method="get">

                  
                <h3> General Search Query: </h3> 
                <div class="form-group search-form-group">
                    <div class="input-group input-group-lg search-input-group" >
                        <span class="input-group-addon lg">Search Query</span>
                        <input type="text" class="form-control" name="q" placeholder="Byrd Hornpipe" >
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="This searches across the <em>textual content and metadata of all entities </em> in the database for matches with the queried terms. The default operator is AND." >
                            <span class="glyphicon glyphicon-info-sign"></span>
                        </span> 
                    </div>
                </div>


                <hr></hr>
                <h3> Limit Results by... </h3>
                    
                <div class="form-group search-form-group">
                    <!-- Name Filter -->

                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">Title</span>
                        <input type="text" class="form-control" name="titlefilt" placeholder="Agnus Dei">
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Terms entered here will be searched for in the <em> titles of pieces and movements</em>.">
                            <span class="glyphicon glyphicon-info-sign"></span>
                        </span> 
                    </div>

                <!-- Name Filter -->

                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">Composer's Name</span>
                        <input type="text" class="form-control" name="namefilt" placeholder="Jacob Obrecht">
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Terms entered here will be searched for in the <em> names of composers </em>, and in the <em> composer-names of pieces and movements</em>. For example, a search for 'Handel' should return Handel the composer, as well as the pieces and movements he composed.">
                            <span class="glyphicon glyphicon-info-sign"></span>
                        </span> 
                    </div>

                <!-- Genre Filter -->
                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">Genres/Subgenres</span>
                        <input type="text" class="form-control" name="" placeholder="Parody AND Mass">
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Terms entered here will be searched for in the <em> genre/subgenre field of pieces and movements</em>.">
                            <span class="glyphicon glyphicon-info-sign" ></span>
                        </span> 
                    </div> 

                <!-- InstrumentVoice Filter -->
                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">Instruments/Voices</span>
                        <input type="text" class="form-control" name="" placeholder="Supranus OR Soprano">
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Terms entered here will be searched for in the <em> instrumentation/voicing field of pieces and movements</em>.">
                            <span class="glyphicon glyphicon-info-sign" ></span>
                        </span> 
                    </div>

                <!-- Language Filter -->
                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">Language</span>
                        <input type="text" class="form-control" name="" placeholder="Latin">
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Terms entered here will be searched for in the <em> language field of pieces and movements</em>.">
                            <span class="glyphicon glyphicon-info-sign" ></span>
                        </span> 
                    </div>  

                <!-- Location Filter -->
                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">City/Country</span>
                        <input type="text" class="form-control" name="" placeholder="Germany OR Austria">
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Terms entered here will be searched for in the <em> city/country-of-composer field of pieces and movements</em>.">
                            <span class="glyphicon glyphicon-info-sign" ></span>
                        </span> 
                    </div> 

                <!-- Source-Info Filter -->
                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">Source Information</span>
                        <input type="text" class="form-control" name="" placeholder="Petrucci">
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Terms entered here will be searched for in the <em> city/country-of-composer field of pieces and movements</em>.">
                            <span class="glyphicon glyphicon-info-sign" ></span>
                        </span> 
                    </div> 


                <!-- Tag Filter -->
                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">Tags</span>
                        <input type="text" class="form-control" name="tagfilt" placeholder="Tag1 Tag2">
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Terms entered here will be searched for in the <em> tags of pieces and movements</em>.">
                            <span class="glyphicon glyphicon-info-sign"></span>
                        </span> 
                    </div>


                <!-- Date Filter -->
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="input-group input-group-lg search-input-group">
                            <span class="input-group-addon lg">Date Range</span>
                                <input type="text" class="form-control" name="datefiltf" placeholder="From: (YYYY)" >
                            </div>
                        </div>

                        <div class="col-lg-6">
                            <div class="input-group input-group-lg search-input-group">
                                <input type="text" class="form-control" name="datefiltt" placeholder="To: (YYYY)" >
                                <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="The date range entered here will be searched for overlaps with the <em> composition range of pieces and movements</em>, and the <em>lifetime of composers</em>.">
                                    <span class="glyphicon glyphicon-info-sign"></span>
                                </span>
                            </div>
                        </div>
                    </div>

 
                    <div class="row">

                        <!-- Voice Filter -->
                        <div class="col-lg-12">
                            <div class="input-group input-group-lg search-input-group">
                                <span class="input-group-addon lg">Number of Voices</span>
                                <input type="text" class="form-control" name="voicefilt" placeholder="3 OR 4 OR 5">
                                <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Numbers entered here will be searched for in the <em> number-of-voices field of pieces and movements</em>.">
                                    <span class="glyphicon glyphicon-info-sign" ></span>
                                </span> 
                            </div> 
                        </div>

                    </div>



                    <!-- Type Filters -->
                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">Result Type</span>
                        <select id="typefilt" multiple="multiple">
                            <option id="elvis_composer" value="elvis_composer">Composers</option>
                            <option id="elvis_piece" value="elvis_piece">Pieces</option>
                            <option id="elvis_movement" value="elvis_movement">Movements</option>
                            <option id="elvis_collection" value="elvis_collection">Collections</option>
                            <option id="elvis_tag" value="elvis_tag">Tags</option>
                            <option id="elvis_user" value="elvis_user">Users</option>
                        </select>
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" data-html='true' title="Results will be limited to the types chosen here.">
                            <span class="glyphicon glyphicon-info-sign"></span>
                        </span> 
                    </div> 
                </div>

                <!-- Sorting --> 
                <hr></hr>
                <h3> Sort Results By... </h3>

                <div class="form-group search-form-group">

                    <div class="input-group input-group-lg search-input-group">
                        <span class="input-group-addon lg">Ordering Scheme</span>
                        <select id="sortby">
                            <option value=""> Default (By Type)</option>
                            <option value="name_sort asc"> Alphabetical &#9660; </option>
                            <option value="name_sort desc"> Reverse Alphabetical &#9650; </option>
                            <option value="date_general asc"> Chronological &#9660;</option>
                            <option value="date_general desc"> Reverse Chronological &#9650; </option>
                        </select>
                        <span class="input-group-addon" data-toggle="tooltip" data-container="body" data-placement="right" title="The 'Default' ordering scheme orders by relevance; tied results are ordered by result type." >
                            <span class="glyphicon glyphicon-info-sign"></span>
                        </span> 
                    </div> 
                </div>


                <!-- Submit -->
                <hr></hr>
                <div>
                    <button type="button" class="btn btn-default btn-lg submit" id="asearch-submit">  Search
                        <span class="glyphicon glyphicon-search"></span>
                    </button>
                     &nbsp;  <a id="asearch-reset">Reset Your Search </a>                              
                </div>

                
            </form>
            </div>                    
  
        </div>

           <!-- Help  -->
        <div class="tab-pane fade" id="help">

            <div class="panel-body">
                <h4> General Searching </h4>
                <p> A basic, Google-esque search. Results are based on occurrences of the search terms in the title/name, composer, parent piece, and tag fields of an item. Items returned may be any type (e.g. a composer, a piece, or a corpus). Use this if you want to quickly look for the most relevant items - the database will order results based on relevancy. </p>
                <h4> Advanced Searching </h4>
                <p> A customisable search. Results are based on the search terms for specific, user-chosen fields of an item. Items returned may be restricted to specific types, and may be sorted on specific fields. Use this if you have a concrete idea of the items, and their attributes, that you are looking for. </p>
                <h4> Downloading Results </h4>
                <p> Each <button class="btn btn-mini btn-success"><span class="glyphicon glyphicon-plus"></span></button> recursively sends its object's attachments to your downloads. For example, clicking this in a piece-typed result will send all of its attachments, and the attachments of its movements, to your downloads cart. The <button class="btn btn-success btn-sm">Add Results on Current Page to Downloads <span class="glyphicon glyphicon-plus"></span></button> will recursively send all the attachments of the current page's results to your downloads. In other words, it's like clicking all of the small green buttons at once. The <button class="btn btn-danger btn-sm"> Add All Query Results to Downloads <span class="glyphicon glyphicon-plus"></span></button> will do the same for every page of results in your query.</p>
            </div>
      
        </div>

    </div>



{% if content.current_query %}

    {% include "search/search_results.html" %}

{% endif %}

</div>

</body>


{% endblock %}
