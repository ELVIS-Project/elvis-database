{% extends "base/base_detail.html" %}

{% block extra_hd %}
    <title>{{ content.title }}</title>
    {{ block.super }}
    <script>
        $(document).ready(function ($) {

            $("#delete-button").click(function (event) {
                $base_modal_header.html("<h4 class='modal-title'>Confirm Deletion.</h4>");
                $base_modal_body.html("<p>Are you sure you want to delete this piece?</p>");
                $base_modal_footer.html('<button type="button" class="btn btn-default" data-dismiss="modal">No</button>' +
                        '<button id="confirm-delete-button" type="button" class="btn btn-danger" data-dismiss="modal">' +
                        '<span class="glyphicon glyphicon-remove"></span>Yes</button>');
                $base_modal.modal('show');
                $("#confirm-delete-button").click(function (event) {
                    $.ajax({
                        type: "delete",
                        url: window.location.href,
                        success: function (data) {
                            console.log("Deleted {{ content.title }}");
                            document.location.href = '/pieces/?creator={{ request.user.username }}';
                        }
                    })
                });
            });
        });
    </script>
{% endblock %}

{% block detail_header %}
    <h1>{{ content.title }}</h1><hr>
{% endblock %}

{% block detail_buttons %}
    {% include "base/download-badge.html" with id=content.uuid type="elvis_piece" button_type="button" in_cart=content.in_cart%}
{% endblock %}

{% block detail_tab_content %}

    <div class="row">
        <div class="col-xs-6">
            <dl class="dl-horizontal">
                <dt>Composer</dt>
                <dd>
                    <a href="{{ content.composer.url }}">{{ content.composer.title }}</a>
                </dd>
                <dt>Date of Composition</dt>
                {% if content.composition_start_date  == content.composition_end_date %}
                    <dd>{{ content.composition_start_date }}</dd>
                {% elif content.composition_start_date %}
                    <dd>{{ content.composition_start_date }}-{{ content.composition_end_date }} </dd>
                {% else %}
                    <dd>{{ content.composition_end_date }}</dd>
                {% endif %}
                <dt>Number of voices</dt>
                <dd>
                    {{ content.number_of_voices }}
                </dd>
                <dt>Genre{{ content.genres|length|pluralize }}</dt>
                <dd>
                    {% for genre in content.genres %}
                        {{ genre.title }}{% if not forloop.last %},&nbsp;
                        {% endif %}
                    {% empty %}
                        Unknown
                    {% endfor %}
                </dd>
                <dt>Instrument
                    Voice{{ content.instruments_voices|length|pluralize }}</dt>
                <dd>
                    {% for instrument in content.instruments_voices %}
                        {{ instrument.title }}{% if not forloop.last %},&nbsp;
                        {% endif %}
                    {% empty %}
                        Unknown
                    {% endfor %}
                </dd>
                {% if content.collections %}
                    <dt>Collection{{ content.collections|length|pluralize }}
                    <dd>
                    {% for collection in content.collections %}
                        {% if collection.public %}
                            <a href="{{ collection.url }}">{{ collection.title }}</a>
                        {% endif %}
                    {% endfor %}
                    </dd>
                {% endif %}
            </dl>
        </div>
        <div class="col-xs-6">
            <dl class='dl-horizontal'>

                <dt>Place of Origin</dt>
                <dd>
                    {% for place in content.locations %}
                        {{ place.title }}{% if not forloop.last %},&nbsp;
                        {% endif %}
                    {% empty %}
                        Unknown
                    {% endfor %}
                </dd>
                <dt>Language{{ content.languages|length|pluralize }}</dt>
                <dd>
                    {% for language in content.languages %}
                        {{ language.title }}{% if not forloop.last %},&nbsp;
                        {% endif %}
                    {% empty %}
                        Unknown
                    {% endfor %}
                </dd>
                <dt>Source{{ content.languages|length|pluralize }}</dt>
                <dd>
                    {% for source in content.sources %}
                        {{ source.title }}{% if not forloop.last %},&nbsp;
                        {% endif %}
                    {% empty %}
                        Unknown
                    {% endfor %}
                </dd>
                <dt>Religiosity</dt>
                <dd>{{ content.religiosity }}</dd>
                <dt>Voice Type</dt>
                <dd>{{ content.vocalization }}</dd>
                {% if content.tags %}
                    <dt>Tag{{ content.tags.count|length|pluralize }}</dt>
                    <dd>
                        {% for tag in content.tags %}
                            <a href="{{ tag.url }}"
                               class="label label-primary rounded">{{ tag.title }} </a>
                            &nbsp;
                        {% endfor %}
                    </dd>
                {% endif %}
            </dl>
        </div>
    </div>

    {% if content.comment %}
        <h3>Comment</h3>
        <div id="hidden-comment" hidden="hidden">{{ content.comment }}</div>
        <div id='rendered-comment' class="well"></div>
    {% endif %}

    {% if content.movements %}
        <h3>Movements
            <small>({{ content.movements | length }})</small>
        </h3>
        {% for m in content.movements %}
            {% include "base/list_item_compact.html" with url=m.url title=m.title id=m.uuid type="elvis_movement" in_cart=m.in_cart%}
        {% endfor %}
    {% endif %}

    {% if content.attachments and user.is_authenticated %}
        <h3>Attachments
            <small>({{ content.attachments | length }})</small>
        </h3>
        {% for a in content.attachments %}
            {% include "base/list_item_compact.html"  with url=a.url title=a.title%}
        {% endfor %}
    {% endif %}



{% endblock %}
