{% extends "base.html" %}


<!-- LM: TODO Move download history elsewhere.... onsubmit="return confirm('Proceed?');"  --> 

{% block wrap %}
<h2>Your Downloads</h2>
<div class="col-md-12">
    <form id="download-form" action="/downloading/" method="post" > {% csrf_token %}
    
        <div class="row">
            <span class="help-block">Select items for downloading. Unwanted files may also be removed from your downloads.</span>
            <table class="table table-condensed">
                <thead>
                    <tr>
                        <th> <input type="checkbox" name="select-all" id="select-all" checked="true"/> Select All </th>
                        <th>Title</th>
                        <th>File Name </th>
                        <th>Composer</th>
                        <th>Type</th>
                        <!--<th>Delete</th>-->
                    </tr>
                </thead>
                <tbody>
                    {% for attachment in content.attachments %}
                        <tr>

                            {% for piece in attachment.pieces %}
                                <!-- Old item value {{ attachment.attachment_path }}/{{ attachment.file_name }} -->
                                <td> 
                                <input class="checkable" type="checkbox" name="a_ids" value="{{ attachment.id }}" checked="true">
                                </td>
                                <td><a href="{{ piece.url }}">{{ piece.title }}</a></td>
                                <td> {{ attachment.file_name }} </td>
                                <td><a href="{{ piece.composer.url }}">{{ piece.composer.name }}</a></td>
                                <td><span class="label label-success">Piece</span></td>
                                <!--<td class="danger">
                                    {% include "includes/delete-badge-inc.html" %}
                                </td>-->
                            {% endfor %}
                            {% for mvmt in attachment.movements %}
                                <td>
                                <input class="checkable" type="checkbox" name="a_ids" value="{{ attachment.id }}" checked="true">
                                </td>
                                <td><a href="{{ mvmt.url }}">{{ mvmt.title }}</a></td>
                                <td> {{ attachment.file_name }} </td>
                                <td><a href="{{ mvmt.composer.url }}">{{ mvmt.composer.name }}</a></td>
                                <td><span class="label label-info">Movement</span></td>
                               <!-- <td class="danger">
                                    {% include "includes/delete-badge-inc.html" %}
                                </td> -->
                            {% endfor %}
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4">
                                <em>No downloads.</em>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <script type="text/javascript">
            // From http://stackoverflow.com/questions/386281/how-to-implement-select-all-check-box-in-html
                $('#select-all').click(function(event) {
                    if(this.checked) {
                        $('.checkable').each(function() {
                            this.checked = true;
                        });
                    }
                    else {
                        $('.checkable').each(function() {
                            this.checked = false;
                        });
                    }
                });
            </script>
        </div>


        <div class="row">
            <h4>Select file types to download/remove:</h4>
            <!-- if these are modified, modify downloading_item view too -->
            <label class="checkbox-inline">
                <input type="checkbox" id="mei-select" name="extension" value=".mei" checked="true"> MEI
            </label>
            <label class="checkbox-inline">
                <input type="checkbox" id="musicxml-select" name="extension" value=".xml" checked="true"> MusicXML
            </label>
            <label class="checkbox-inline">
                <input type="checkbox" id="midi-select" name="extension" value=".midi" checked="true"> MIDI
            </label>
            <label class="checkbox-inline">
                <input type="checkbox" id="pdf-select" name="extension" value=".pdf" checked="true"> PDF
            </label>
            <label class="checkbox-inline">
                <input type="checkbox" id="kern-select" name="extension" value=".krn" checked="true"> **kern
            </label>
            <label class="checkbox-inline">
                <input type="checkbox" id="else-select" name="extension" value="OTHERS" checked="true"> All Others
            </label>
            <span class="help-block">Select which file types you wish to download. If a piece or movement does not have one of your selected file types, it will not be downloaded. Choose "all others" to download any formats that do not appear in this checklist. The same applies for removal -- files with the selected types will be removed.</span>
        </div>




        <div class="row">
            <button id="download-all" name="download-all" type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-download"></span>Download Selected</button>
            
            <button id="remove-all" name="remove-all" type="submit" class="btn btn-danger" onClick="return confirm('Are you sure you want to remove these items?')"><span class="glyphicon glyphicon-remove"></span>Remove Selected</button>
            
            <button id="select-elvis" name="select-elvis" type="submit" class="btn btn-danger" onMouseOver="window.status='Click here to filter your files for the ELVIS Web App'; return true"><span class="glyphicon glyphicon-remove"></span>Filter for Web App</button> 
            
            <div id="select-help" style="display: none" class="help-block"> This will find the file best formatted for the ELVIS Web App in each piece or movement, and remove everything else regardless of which files or file types you have selected above. Formats incompatible with Music21 will be removed. </div>

            <script type="text/javascript">
            var e = document.getElementById('select-elvis');
            e.onmouseover = function() {
              document.getElementById('select-help').style.display = 'block';
            }
            e.onmouseout = function() {
              document.getElementById('select-help').style.display = 'none';
            }
            </script>
            <p></p>
        </div>

    </form>

<p></p>
</div>




    <!-- LM: TODO move elsewhere 
    <div class="col-md-0">
        <h4>Download History</h4>
        <table class="table table-condensed">
            <thead>
                <tr>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for download in user.downloads.items %}
                    <tr>
                        <td>{{ download.created }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div> -->


{% endblock %}
