{% extends "base.html" %}


{% block wrap %}

<style type="text/css">
.panel-title:hover {
    cursor: pointer;
}
.tab-content {
    border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    padding: 10px;
}
.nav-tabs {
    margin-bottom: 0;
}
</style>

<head>
    <script type="text/javascript">
    /* $(function(){
        $('#advanced-search-form').submit(function() {            
            $(':input').each(function(){
                if($(this).val() == "" && $(this).attr('name')!= "q"){
                    $(this).attr('disabled', true);
                }    
            });
        });
    });

    $(function(){
        $('#general-search-form').submit(function() {         
            $(':input').each(function(){
                if($(this).val() == "" && $(this).attr('name')!= "q"){
                    $(this).attr('disabled', true);
                }    
            });
        });
    }); */
        
    $(function(){
        $('#asearch-submit').click(function(){
            //$('.panel-collapse').collapse('hide');
            $(':input').each(function(){
                if($(this).val() == "" && $(this).attr('name')!= "q"){
                    $(this).attr('disabled', true);
                }    
            });
            //$('#collapse-asearch').on('hidden.bs.collapse', function () {
            //  $('##advanced-search-form').submit();
            //})
            setTimeout(function(){$('#advanced-search-form').submit()}, 300);
        });
    })

    $(function(){
        $('#gsearch-submit').click(function(){
            //$('.panel-collapse').collapse('hide');
            $(':input').each(function(){
                if($(this).val() == "" && $(this).attr('name')!= "q"){
                    $(this).attr('disabled', true);
                }    
            });
            //$('#collapse-search').on('hidden.bs.collapse', function () {
            //  $('#general-search-form').submit();
            //})
            setTimeout(function(){$('#general-search-form').submit()}, 300);
        });
    })

    $(function(){
        var qstr = window.location.search.replace("?", "");
        var qstr_params = $.parseParams(qstr);
        for (var key in qstr_params){
            $('[name='+key+']').val(qstr_params[key]);
            if(key == 'typefilt' || key=='type'){
                $("[id='"+qstr_params[key]+"']").attr('checked', true);
                //$('[type=checkbox][value="'+qstr_params[key]+'"]').attr('checked',true);
            }
        }
    })
    //onfocus="this.placeholder = ''" onblur="this.placeholder = 'E.g.: Agnus Dei...'"
    /*$(function(){
        $(':text').each(function{
            var placeholder = $(this).attr('placeholder');
            $(this).attr('placeholder-perm', placeholder);
            alert($this.attr('placeholder-perm'));
        })
        $(':text').focus(function() {
            $(this).attr('placeholder', "");
        });
        $(':text').blur(function() {
            var placeholderPerm = $(this).attr('placeholder-perm');
            $(this).attr('placeholder-perm', placeholderPerm);
        });
    })*/
    </script>
</head>

<body>
<h2>Search the Database</h2>

<div class="row col-12" style="  background-color: #ffffff;


  -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
          box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);">
    <!-- Tabs bar -->

        <ul class="nav nav-tabs nav-justified" style=>

            <li class="active"><a href="#gsearch" data-toggle="tab"><h4>General Search</h4></a></li>

            <li class=""><a href="#asearch" data-toggle="tab"><h4>Advanced Search</h4></a></li>

            <li class=""><a href="#help" data-toggle="tab"><h4>Information & Help</h4></a></li>

        </ul>

    <!-- Content -->

    <div class="tab-content">

        <!-- General Search -->
        <div class="tab-pane fade in active" id="gsearch">
        
            <!-- Accordion -->
                        <div class="panel-body" style="margin-bottom: 15px; margin-top:25px; ">
                            <form id="general-search-form" action="/search" method="get">
                                <!-- Query Entry -->
                                <div class="row">
                               
                                            <!-- <input type="text" name="q" class="search-input" placeholder="Search Query... &nbsp; E.g.: Bach Chorale Gott" size="35" style="float: none; margin: 0 auto;"/>                              
                                            <button type="submit" class="btn btn-default btn-sm" id="btn-submit">
                                              Search
                                              <span class="glyphicon glyphicon-search"></span> 
                                              placeholder="Search Query... &nbsp; &nbsp; &nbsp;E.g.: Bach Chorale Gott" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Search Query... &nbsp; &nbsp; &nbsp;E.g.: Bach Chorale Gott'"
                                            </button> -->

                                    <div class="input-group input-group-lg col-md-8 col-md-offset-2">
                                            <input type="text" class="form-control search" name="q"  style="text-align:center; border-radius:4px;">
                                            <span class="input-group-btn">
                                                <button class="btn btn-default submit" type="button" id="gsearch-submit"> Search <span class="glyphicon glyphicon-search"></span> </button>
                                            </span>
                                    </div><!-- /input-group -->
                           
                                </div>
                                <p></p>

                                <!-- Filters --> 
                            </form>
                        </div>

        </div>

        <!-- Advanced Search -->
        <div class="tab-pane fade" id="asearch">
        
            <!-- Accordion -->
                        <div class="panel-body">

                        <form id="advanced-search-form" action="/search" method="get">
                        

                            <div class="form-group">
                              
                              <!-- Submit Button -->
                                <h4> General Search Query: </h4> 

                                    <div class="col-sm-12">
                                        <input type="text" name="q" class="search-input" placeholder="E.g.: Byrd Hornpipe" style="float: none; margin: 0 auto;"/>                              
                                    </div>

                            <!-- Name Filter -->
                                <h4> Limit by Title: </h4>
                                    <div class = "col-sm-12">
                                      <input type="text" name="titlefilt" placeholder="E.g.: Agnus Dei...">
                                      <div class="help-block">Will find results with all entered search terms (use "" to force ordered search) in their title or name, depending on result type filters chosen above. </div>
                                    </div> 

                            <!-- Name Filter -->
                                <h4> Limit by Composer Name: </h4>
                                    <div class = "col-sm-12">
                                      <input type="text" name="namefilt" placeholder="E.g.: Jacob Obrecht...">
                                      <div class="help-block">Will find both composers matching this query and pieces/movements composed by composers matching this query. </div>
                                    </div> 


                            <!-- Tag Filter -->
                                <h4> Limit by Tags: </h4>
                                    <div class = "col-sm-12">
                                      <input type="text" name="tagfilt" placeholder="Tag1 Tag2 ...">
                                    </div> 


                            <!-- Voice Filter -->
                                <h4> Limit by Number of Voices: </h4>
                                    <div class = "col-sm-12">
                                      <input type="text" name="voicefilt" placeholder="E.g.: 4">
                                    </div> 

                            <!-- Date Filter -->
                                <h4> Limit by Date: </h4>
                                    <div class = "col-sm-12">
                                      <input type="text" name="datefiltf" placeholder="From: (YYYY)" maxlength="4">
                                      <input type="text" name="datefiltt" placeholder="To: (YYYY)" maxlength="4">
                                      <div class="help-block">Will filter by birth or composition date, depending on result type filters chosen above.</div>
                                    </div> 

                           <!-- Checkbox Filters -->
                                <h4> Limit by Result Type: </h4>
                                  <div class="col-sm-12">
                                      <div class="col-sm-4">
                                          <div class="checkbox">
                                            <label>
                                              <input type="checkbox" name="typefilt" id="elvis_composer" value="elvis_composer"> Composers
                                            </label>
                                          </div>
                                          <div class="checkbox">
                                            <label>
                                              <input type="checkbox" name="typefilt" id="elvis_piece" value="elvis_piece"> Pieces
                                            </label>
                                          </div>
                                      </div>
                                      <div class="col-sm-4">
                                          <div class="checkbox">
                                            <label>
                                              <input type="checkbox" name="typefilt" id="elvis_movement" value="elvis_movement"> Movements
                                            </label>
                                          </div>
                                          <div class="checkbox">
                                            <label>
                                              <input type="checkbox" name="typefilt" id="elvis_corpus" value="elvis_corpus"> Corpora
                                            </label>
                                          </div>
                                      </div>
                                      <div class="col-sm-4">
                                          <div class="checkbox">
                                            <label>
                                              <input type="checkbox" name="typefilt" id="elvis_tag" value="elvis_tag"> Tags
                                            </label>
                                          </div>
                                          <div class="checkbox">
                                            <label>
                                              <input type="checkbox" name="typefilt" id="elvis_user" value="elvis_user"> Users
                                            </label>
                                          </div>
                                      </div>
                                    </div>

                            <!-- Sorting --> 
                                <h4> Sort by: </h4>
                                    <div class="col-sm-12">
                                          <select name="sortby">
                                          <option value=""> Default (Type) </option>
                                          <option value="name_sort desc"> Alphabetical &#9650; </option>
                                          <option value="name_sort asc"> Alphabetical &#9660; </option>
                                          <option value="date_general desc"> Date &#9650; </option>
                                          <option value="date_general asc"> Date &#9660;</option>
                                          </select>                   
                                      </div>                 
                                  <p></p>
                            </div>

                            <!-- Submit -->
                                <div class="col-md-2 col-md-offset-5">
                                    <button type="button" class="btn btn-default btn-xl submit" id="asearch-submit" >
                                        Search
                                        <span class="glyphicon glyphicon-search"></span> 
                                    </button>
                                </div>                                  
                            
                        </form>
                        </div>                    
  
        </div>

           <!-- Help  -->
        <div class="tab-pane fade" id="help">

                        <div class="panel-body">
                        <h4> General Searching </h4>
                        <p> A basic, Google-esque search. Results are based on occurrences of the search terms in the title/name, composer, parent piece, and tag fields of an item. Items returned may be any type (e.g. a composer, a piece, or a corpus). Use this if you want to quickly look for the most relevant items - the database will order results based on relevancy. </p>
                        <h4> Advanced Searching </h4>
                        <p> A customisable search. Results are based on the search terms for specific, user-chosen fields of an item. Items returned may be restricted to specific types, and may be sorted on specific fields. Use this if you have a concrete idea of the items, and their attributes, that you are looking for. </p>
                        <h4> Downloading Results </h4>
                        <p> Each <button class="btn btn-xs btn-success"><span class="glyphicon glyphicon-plus"></span></button> recursively sends its object's attachments to your downloads. For example, clicking this in a piece-typed result will send all of its attachments, and the attachments of its movements, to your downloads cart. The <button class="btn btn-success btn-sm">Add Results on Current Page to Downloads <span class="glyphicon glyphicon-plus"></span></button> will recursively send all the attachments of the current page's results to your downloads. In other words, it's like clicking all of the small green buttons at once. The <button class="btn btn-danger btn-sm"> Add All Query Results to Downloads <span class="glyphicon glyphicon-plus"></span></button> will do the same for every page of results in your query.</p>
                        </div>
      
        </div>

    </div>

</div>

</body>

<div class="row col-12">


{% if content.current_query %}

 {% include "search/search_results.html" %}

{% endif %}
</div>

<!-- <div class="col-md-4" >
    {% if content.facets %}
        <h2>Search Facets</h2>
        {% for name, facets in content.facets.facet_fields.items %}
        <div class="row">
            <h4>{{ name }}</h4>
            <ul>
                {% for facet, count in facets.items %}
                    <li><a class="facet-link" href="#" data-facet-name="{{ name }}" data-facet-value="{{ facet }}">{{ facet }} </a> ({{ count }})</li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
        <script type="text/javascript">
            // this code manages what happens when a facet link is clicked.
            $(".facet-link").on('click', function(event)
            {
                var qstr = window.location.search.replace("?", "");
                var qstr_params = $.parseParams(qstr);

                var facetName = $(this).data('facet-name');
                var facetValue = $(this).data('facet-value');
                if (!(facetName in qstr_params))
                {
                    var facetQ = facetName + "=" + facetValue;
                    if (qstr != "")
                    {
                        // this makes sure that we either append the 
                        // querystring to an existing query string
                        // (with a "&") or we just append it to the
                        // existing URL.
                        facetQ = "&" + facetQ;
                    }

                    window.location.search = qstr + facetQ;
                }
                event.preventDefault();
            });
        </script>


  <script type="text/javascript">
  function downloadAll(){
    document.getElementsById("list-patch-download-form").submit();
  }

  $('#listDownload').click(function(){
    document.getElementsById("list-patch-download-form").submit();
  });
  </script> 
    {% endif %}


  <h3> Results <button id="listDownload" onclick="downloadAll()" class="btn btn-success btn-sm pull-right" style="display: inline;">
      Add All Results to Downloads <span class="glyphicon glyphicon-plus"></span> 
    </button> 
  </h3>

  <script type="text/javascript">
  function downloadAll(){
    var buttons = document.getElementsByClassName("recursive-patch-download-form");
    for(i = 0; i<buttons.length; i++){
      buttons[i].submit();
    }
  }
  </script> 

     -->
</div>

{% endblock %}
