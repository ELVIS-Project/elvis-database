function cartButtonRefresh(){var t=$("#collection-count");$(".cart-badge, .cart-button").off("click").tooltip().on("click",function(o){return o.preventDefault(),o.stopImmediatePropagation(),$button=$(this),$button.hasClass("disabled")?($button.blur(),!1):(type=$button.hasClass("cart-badge")?"badge":"button",action=$button.hasClass("btn-success")?"add":"remove",cart_timeout="add"===action?setTimeout(function(){$base_modal_header.html("<h4 class='modal-title'>Adding to Downloads...</h4>"),$base_modal_body.html("<p>Adding large collections or composer oeuvres to your downloads can take a little time...</p>"),$base_modal_footer.html("<div class='progress'><div class='progress-bar progress-bar-striped active' role='progressbar' style='width: 100%'></div> </div>"),$base_modal.modal("show")},1e3):setTimeout(function(){$base_modal_header.html("<h4 class='modal-title'>Removing from Downloads...</h4>"),$base_modal_body.html("<p>Removing large collections or composer oeuvres from your downloads can take a little time...</p>"),$base_modal_footer.html("<div class='progress'><div class='progress-bar progress-bar-striped active' role='progressbar' style='width: 100%'></div> </div>"),$base_modal.modal("show")},1e3),void $.ajax({type:"post",url:"/download-cart/",data:$(o.target).parents(".recursive-patch-download-form").serialize(),success:function(o){clearTimeout(cart_timeout),$base_modal.modal("hide"),t.fadeOut(100,function(){t.text("("+o.count+")")}),t.fadeIn(100),"add"===action?$button.fadeOut(100,function(){$button.blur().tooltip("hide").attr({"data-original-title":"Remove From Downloads"}).tooltip("fixTitle").removeClass("btn-success").addClass("btn-danger"),$($button.siblings("[name='action']")).val("remove"),"badge"===type?$button.html("<span class='glyphicon glyphicon-minus'></span>"):($button.html("Remove from Downloads"),location.reload())}).fadeIn(100):$button.fadeOut(100,function(){$button.blur().tooltip("hide").attr({"data-original-title":"Add to Downloads"}).tooltip("fixTitle").removeClass("btn-danger").addClass("btn-success"),$($button.siblings("[name='action']")).val("add"),"badge"===type?$button.html("<span class='glyphicon glyphicon-plus'></span>"):($button.html("Add to Downloads"),location.reload())}).fadeIn(100)},error:function(t){$base_modal_header.html("<h4 class='modal-title'>Error modifying downloads!</h4>"),$base_modal_body.html("<p>Something went wrong and your cart was not modified!</p>"),$base_modal_footer.html("<button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>")}}))})}function init_cart_buttons(){for(var t=$(".recursive-patch-download-form"),o=[],a=0;a<t.size();a++){var e=t[a].children,n=null,l=null;for(var s in e){if(null!==n&&null!==l)break;var i=e[s];"item_type"!==i.name?"id"===i.name&&(l=i.value):n=i.value}o.push({type:n,id:l,num:a})}$.ajax({url:"/download-cart/",data:{check_in_cart:JSON.stringify(o)},async:!1,success:function(o){console.log(o);for(var a=0;a<t.size();a++)"Piece"!==o[a].in_cart?o[a].in_cart!==!0?o[a].in_cart===!1&&$(t[a]).prepend('<button type="button" class="btn btn-mini btn-success cart-badge" data-container="body" data-toggle="tooltip" data-placement="top" title="Add to Downloads"><span class="glyphicon glyphicon-plus"> </span> </button> '):($(t[a].children[2]).val("remove"),$(t[a]).prepend('<button type="button" class="btn btn-mini btn-danger cart-badge" data-container="body" data-toggle="tooltip" data-placement="top" title="Remove from Downloads"><span class="glyphicon glyphicon-minus"> </span> </button>')):$(t[a]).prepend('<button type="button" class="btn btn-mini btn-info disabled" data-container="body" data-toggle="tooltip" data-placement="top" title="Movement in Downloads under parent Piece. Remove Piece to modify."><span class="glyphicon glyphicon-lock"> </span> </button>')}}),cartButtonRefresh()}var type=null,action=null,$button=null,cart_timeout=null;