function autocomplete(e,t,l,n){function i(){if("list"===n){var e=c.val().split(";");e[e.length-1]=o;for(var t=e[0]+"; ",l=1;l<e.length;l++)t=t+e[l].trim()+"; ";c.val(t)}else if("bool"===n){var e=c.val().split(/(AND|OR|NOT)/);e[e.length-1]=o;for(var l=0;l<e.length;l++)e[l]=$.trim(e[l]);c.val(e.join(" "))}else c.val(o);u=encodeURI(o)}var o,s=-1,a=-1,g=!0,r=!0,u="",c=$("#"+e),v=$("#"+t),f=v.children().children();c.on("keydown",function(e){var t=e.keyCode;if(40===t&&(e.preventDefault(),-1!==s&&f.eq(s).toggleClass("active"),s=(s+1)%a,f.eq(s).toggleClass("active"),o=f.eq(s).text()),38===t&&(e.preventDefault(),f.eq(s).toggleClass("active"),s-=1,0>s&&(s=a-1),f.eq(s).toggleClass("active"),o=f.eq(s).text()),13===t&&a>0){if(e.preventDefault(),-1==s)return;i(),v.html(""),s=-1,a=0,c.focusout()}13===t&&(e.preventDefault(),c.focusout()),186===t&&(v.html(""),s=-1,a=0,g=!0,o="")}),c.on("keyup focusin",function(e){var t=e.keyCode;if(t>47&&58>t||t>64&&91>t||8===t||"focusin"===e.type){if("list"===n)var i=c.val().split(";"),h=encodeURI(i[i.length-1].trim());else if("bool"===n)var i=c.val().split(/(AND|OR|NOT)/),h=encodeURI(i[i.length-1].trim());else h=encodeURI(c.val());if("bool"===n)var m=c.parent().width();else var m=c.parent().width()-130;(8===t||h.length<2)&&(g=!0),(r||g)&&h.length>2?$.ajax({url:"/suggest/",data:{q:h,d:l},success:function(e){if(v.html(""),a=e.length,s=-1,1===a&&h===u)return!1;g&&0!==a&&(g=!1),r=a>0?!0:!1;for(var t="",l=0;l<e.length;l++)t+=l===s?"<li class='list-group-item active suggestion-element' id='suggestion-item"+l+"'>"+e[l].name+"</li>":"<li class='list-group-item suggestion-element' id='suggestion-item"+l+"'>"+e[l].name+"</li>";v.html("<ul class='listgroup suggestion-menu' style='width:"+m+"px'>"+t+"</ul>"),f=v.children().children(),o=f.eq(s).text()},dataType:"json"}):(v.html(""),a=0,s=0,o="")}}),c.on("focusout",function(){""!==o&&(u=encodeURI(o)),v.html(""),g=!0}),v.on("mouseover",function(e){var t=$(e.target);if(t.hasClass("list-group-item")){f.eq(s).toggleClass("active",!1),t.toggleClass("active",!0);var l=t.attr("id");s=l[l.length-1],o=f.eq(s).text()}}),v.on("mousedown",function(e){console.log(e),e.target.className.indexOf("suggestion-element")>-1&&(i(),v.html(""),s=-1,a=0)})}